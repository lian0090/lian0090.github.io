<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Lian Lian</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Lian Lian">

    <link href="/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px;
      }
    </style>
    <link href="/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></sc\
ript>
    <![endif]-->
  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".na\
v-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">Lian Lian</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="/">Home</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="container">

      <p><code>R
library(FWd)
data(wheat)
attach(wheat.Y)
OLSh0=lmFWh0(y,VAR,ENV)
OLShmu=lmFWhmu(y,VAR,ENV)
head(OLSh0$b)
head(OLShmu$b)
</code></p>

<p>b for OLS are the same. 
```R
&gt; head(OLSh0$b)
               [,1]
103122  -0.01499334
1047493 -0.23156180
1058137  0.15262836
1064007  0.33197972
1066175  0.16119069
1066279  0.14964002
&gt; 
head(OLShmu$b)
               [,1]
103122  -0.01499334
1047493 -0.23156180
1058137  0.15262836
1064007  0.33197972
1066175  0.16119069
1066279  0.14964002</p>

<p>```</p>

<p>But we should notice that the estimates of g and the interpretation of g changed
<code>R
&gt; cor(OLSh0$g,OLShmu$g)
         [,1]
[1,] 0.399232
</code></p>

<p>The effect of changing the mean of h on Gibbs method 
<code>R
GibbsIh0=GibbsFWh0(y=y,VAR=VAR,ENV=ENV,saveAt="GibbsIh0")
GibbsIhmu=GibbsFWhmu(y=y,VAR=VAR,ENV=ENV,saveAt="GibbsIhmu")
</code>
results
<code>R
cor(GibbsIhmu$b,GibbsIh0$b)
           Init1
Init1 -0.3296878
</code>
The variance estimates for var_b is greatly reduced by introducing mu into h.
<code>R
&gt; GibbsIhmu$var_b
    Init1 
0.0144938 
&gt; GibbsIh0$var_b
     Init1 
0.09865855 
</code> 
Why if we center y before using GibbsFWhmu?
By centering y, we almost recovered the original solutions with GibbsFWh0.
<code>R
yc=y-mean(y)
GibbsI.yc.hmu=GibbsFWhmu(y=yc,VAR=VAR,ENV=ENV)
GibbsI.yc.hmu$var_b
     Init1 
0.09357356
cor(GibbsI.yc.hmu$b,GibbsIh0$b)
          Init1
Init1 0.9499459
</code></p>

<h2 id="test-different-modelss-prediction-accuracy">test different models’s prediction accuracy</h2>

<p>```R
yNA=y
set.seed(12345)
whichNa=seq(from=0,to=2392,by=4)+sample(1:4,size=599,replace=T)
yNA[whichNa]=NA</p>

<p>OLS=lmFWh0(y=yNA,VAR=VAR,ENV=ENV)
GibbsIhmu=GibbsFWhmu(y=yNA,VAR=VAR,ENV=ENV,seed=12345)
GibbsIhmuyc=GibbsFWhmu(y=scale(yNA,center=T,scale=F),VAR=VAR,ENV=ENV,seed=12345)
GibbsIh0=GibbsFWh0(y=yNA,VAR=VAR,ENV=ENV, seed=12345)
<code>
The results on prediction accuracy. Even if we center y, the results on prediction accuracy is still suboptimal. Change seeds will get similar results. 
</code>R
&gt; cor(y[whichNa],OLS$yhat[whichNa,])
[1] 0.6218797
&gt; cor(y[whichNa],GibbsIhmu$yhat[whichNa,])
[1] 0.7471006
 cor(y[whichNa],GibbsIhmuyc$yhat[whichNa,])
[1] 0.783637
&gt; cor(y[whichNa],GibbsIh0$yhat[whichNa,])
[1] 0.7927549
```</p>

<p>Now, that’s introduce another model, to avoid the confounding effect among mu and h, we set h[0]=0, and only estimate all other h. The new model is y=mu+g+h+bh+e, where h~N(0,H\sigma^2_h), and we ask h[0] to be 0. </p>

<p>Check the model convergence
<code>R
GibbsIh10=GibbsFWh10(y=y,VAR=VAR,ENV=ENV,saveAt="GibbsIh10")
load("GibbsIh10samps.rda")
png("traceFWh10.png")
plot(samps[,c('mu','h[1]','h[2]','b[1]','b[2]','var_e')],density=F)
dev.off()
</code>
The var_b
<code>R
&gt; GibbsIh10$var_b
    Init1 
0.0683286 
</code>
The trace plot for GibbsFWh10
<img src="https://lian0090.github.io/FWd/traceFWh10.png" alt="trace plot for GibbsFWh10" /></p>

<p>Compare with the original full model GibbsFWh0
The trace plot for GibbsFWh0
<code>R
setwd("/Users/lianlian/Dropbox/github/lian0090.github.io/FWd"
png("traceFWh0.png")
plot(samps[,c('mu','h[1]','h[2]','b[1]','b[2]','var_e')],density=F)
dev.off()
</code>
The trace plot for GibbsFWh0
<img src="https://lian0090.github.io/FWd/traceFWh0.png" alt="trace plot for GibbsFWh0" /></p>

<p>The new model’s prediction accuracy, it is even better than the original model.
<code>R
GibbsIh10=GibbsFWh10(y=yNA,VAR=VAR,ENV=ENV, seed=12345)
cor(y[whichNa],GibbsIh10$yhat[whichNa,])
[1] 0.7968909
</code></p>

<p>Now, check the GibbsFWh10 model on the use the genomic matrix
<code>R
GibbsAh0=GibbsFWh0(y=yNA,VAR=VAR,ENV=ENV,saveAt="GibbsAh0",A=wheat.G,seed=12345)
GibbsAh10=GibbsFWh10(y=yNA,VAR=VAR,ENV=ENV, saveAt="GibbsAh10",A=wheat.G,seed=12345)
</code>
results
<code>R
&gt; cor(y[whichNa],GibbsAh0$yhat[whichNa,])
[1] 0.8055785
 cor(y[whichNa],GibbsAh10$yhat[whichNa,])
[1] 0.8075624
</code></p>

<p><code>
load("GibbsAh10samps.rda")
png("traceFWAh10.png")
plot(samps[,c('mu','h[1]','h[2]','var_e')],density=F)
dev.off()
</code></p>

<p>The trace plot for GibbsFWAh10
<img src="https://lian0090.github.io/FWd/traceFWAh10.png" alt="trace plot for GibbsFWAh0" /></p>


    </div>

  </body>
</html>
